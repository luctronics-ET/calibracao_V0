CREATE TABLE IF NOT EXISTS "migrations" ("id" integer primary key autoincrement not null, "migration" varchar not null, "batch" integer not null);
CREATE TABLE IF NOT EXISTS "laboratorios" ("id" integer primary key autoincrement not null, "nome" varchar not null, "cnpj" varchar, "acreditado" tinyint(1) not null default '0', "escopo" text, "contato" varchar, "endereco" text, "created_at" datetime, "updated_at" datetime);
CREATE TABLE IF NOT EXISTS "contratos" ("id" integer primary key autoincrement not null, "laboratorio_id" integer not null, "edital_num" varchar, "vigencia_ini" date, "vigencia_fim" date, "preco_unitario" numeric, "anexos" text, "created_at" datetime, "updated_at" datetime, foreign key("laboratorio_id") references "laboratorios"("id") on delete cascade);
CREATE TABLE IF NOT EXISTS "lotes_envio" ("id" integer primary key autoincrement not null, "codigo_lote" varchar, "data_envio" date, "data_retorno" date, "responsavel_envio" varchar, "transportadora" varchar, "status" varchar check ("status" in ('preparacao', 'enviado', 'em_calibracao', 'retornado', 'cancelado')) not null default 'preparacao', "observacoes" text, "created_at" datetime, "updated_at" datetime);
CREATE TABLE IF NOT EXISTS "lote_itens" ("id" integer primary key autoincrement not null, "lote_id" integer not null, "equipamento_id" integer not null, "situacao" varchar, "created_at" datetime, "updated_at" datetime, foreign key("lote_id") references "lotes_envio"("id") on delete cascade, foreign key("equipamento_id") references "equipamentos"("id") on delete cascade);
CREATE TABLE IF NOT EXISTS "usuarios" ("id" integer primary key autoincrement not null, "nome" varchar not null, "setor" varchar, "permissao" varchar not null default 'user', "email" varchar, "senha_hash" varchar, "created_at" datetime, "updated_at" datetime);
CREATE TABLE IF NOT EXISTS "logs" ("id" integer primary key autoincrement not null, "usuario_id" integer, "tabela" varchar, "referencia_id" integer, "acao" varchar, "detalhe" text, "created_at" datetime, "updated_at" datetime, foreign key("usuario_id") references "usuarios"("id") on delete set null);
CREATE TABLE IF NOT EXISTS "parametros_metrologicos" ("id" integer primary key autoincrement not null, "equipamento_id" integer not null, "descricao" varchar, "valor_nominal" varchar, "tolerancia" varchar, "unidade" varchar, "metodo" varchar, "created_at" datetime, "updated_at" datetime, foreign key("equipamento_id") references "equipamentos"("id") on delete cascade);
CREATE TABLE IF NOT EXISTS "notifications" ("id" varchar not null, "type" varchar not null, "notifiable_type" varchar not null, "notifiable_id" integer not null, "data" text not null, "read_at" datetime, "created_at" datetime, "updated_at" datetime, primary key ("id"));
CREATE INDEX "notifications_notifiable_type_notifiable_id_index" on "notifications" ("notifiable_type", "notifiable_id");
CREATE TABLE IF NOT EXISTS "certificates" ("id" integer primary key autoincrement not null, "calibracao_id" integer not null, "numero_certificado" varchar not null, "arquivo_pdf" varchar, "data_emissao" date not null, "data_validade" date not null, "organismo_acreditacao" varchar, "numero_acreditacao" varchar, "observacoes" text, "valido" tinyint(1) not null default '1', "created_at" datetime, "updated_at" datetime, foreign key("calibracao_id") references "calibracoes"("id") on delete cascade);
CREATE INDEX "certificates_numero_certificado_index" on "certificates" ("numero_certificado");
CREATE INDEX "certificates_data_validade_index" on "certificates" ("data_validade");
CREATE UNIQUE INDEX "certificates_numero_certificado_unique" on "certificates" ("numero_certificado");
CREATE TABLE IF NOT EXISTS "measurement_parameters" ("id" integer primary key autoincrement not null, "certificate_id" integer not null, "parametro_nome" varchar not null, "unidade" varchar not null, "valor_nominal" numeric, "valor_medido" numeric not null, "incerteza" numeric, "erro" numeric, "padrao_referencia" varchar, "resultado" varchar check ("resultado" in ('conforme', 'nao_conforme', 'restricao')) not null default 'conforme', "observacoes" text, "created_at" datetime, "updated_at" datetime, foreign key("certificate_id") references "certificates"("id") on delete cascade);
CREATE INDEX "measurement_parameters_parametro_nome_index" on "measurement_parameters" ("parametro_nome");
CREATE TABLE IF NOT EXISTS "reference_standards" ("id" integer primary key autoincrement not null, "codigo" varchar not null, "descricao" varchar not null, "fabricante" varchar, "modelo" varchar, "numero_serie" varchar, "data_calibracao" date, "data_validade" date, "certificado_rastreabilidade" varchar, "cadeia_rastreabilidade" text, "incerteza" numeric, "status" varchar check ("status" in ('ativo', 'vencido', 'manutencao', 'inativo')) not null default 'ativo', "created_at" datetime, "updated_at" datetime);
CREATE INDEX "reference_standards_codigo_index" on "reference_standards" ("codigo");
CREATE INDEX "reference_standards_status_index" on "reference_standards" ("status");
CREATE INDEX "reference_standards_data_validade_index" on "reference_standards" ("data_validade");
CREATE UNIQUE INDEX "reference_standards_codigo_unique" on "reference_standards" ("codigo");
CREATE TABLE calibracoes (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, equipamento_id INTEGER NOT NULL, laboratorio_id INTEGER DEFAULT NULL, lote_id INTEGER DEFAULT NULL, data_envio DATE DEFAULT NULL, data_recebimento_lab DATE DEFAULT NULL, data_calibracao DATE DEFAULT NULL, data_retorno DATE DEFAULT NULL, data_aceitacao_et DATE DEFAULT NULL, status VARCHAR(255) DEFAULT NULL COLLATE "BINARY", resultado VARCHAR(255) DEFAULT NULL COLLATE "BINARY", certificado_num VARCHAR(255) DEFAULT NULL COLLATE "BINARY", arquivo_certificado VARCHAR(255) DEFAULT NULL COLLATE "BINARY", custo NUMERIC(10, 0) DEFAULT NULL, responsavel_et VARCHAR(255) DEFAULT NULL COLLATE "BINARY", created_at DATETIME DEFAULT NULL, updated_at DATETIME DEFAULT NULL, "observacoes" text, FOREIGN KEY (equipamento_id) REFERENCES equipamentos (id) ON UPDATE NO ACTION ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE, FOREIGN KEY (laboratorio_id) REFERENCES laboratorios (id) ON UPDATE NO ACTION ON DELETE SET NULL NOT DEFERRABLE INITIALLY IMMEDIATE, FOREIGN KEY (lote_id) REFERENCES lotes_envio (id) ON UPDATE NO ACTION ON DELETE SET NULL NOT DEFERRABLE INITIALLY IMMEDIATE);
CREATE INDEX IDX_AC6823D4B172197C ON calibracoes (lote_id);
CREATE INDEX IDX_AC6823D4677ED5D4 ON calibracoes (laboratorio_id);
CREATE INDEX IDX_AC6823D4C20F76DE ON calibracoes (equipamento_id);
CREATE TABLE IF NOT EXISTS "classes" ("id" integer primary key autoincrement not null, "nome" varchar not null, "descricao" varchar, "created_at" datetime, "updated_at" datetime);
CREATE UNIQUE INDEX "classes_nome_unique" on "classes" ("nome");
CREATE TABLE IF NOT EXISTS "tipos_equipamento" ("id" integer primary key autoincrement not null, "classe_id" integer, "nome" varchar not null, "descricao" varchar, "created_at" datetime, "updated_at" datetime, foreign key("classe_id") references "classes"("id") on delete cascade);
CREATE TABLE IF NOT EXISTS "setores" ("id" integer primary key autoincrement not null, "nome" varchar not null, "sigla" varchar, "responsavel" varchar, "created_at" datetime, "updated_at" datetime);
CREATE UNIQUE INDEX "setores_nome_unique" on "setores" ("nome");
CREATE TABLE IF NOT EXISTS "localizacoes" ("id" integer primary key autoincrement not null, "nome" varchar not null, "andar" varchar, "sala" varchar, "predio" varchar, "created_at" datetime, "updated_at" datetime);
CREATE UNIQUE INDEX "localizacoes_nome_unique" on "localizacoes" ("nome");
CREATE TABLE IF NOT EXISTS "status_equipamentos" ("id" integer primary key autoincrement not null, "nome" varchar not null, "descricao" varchar, "cor" varchar, "created_at" datetime, "updated_at" datetime);
CREATE UNIQUE INDEX "status_equipamentos_nome_unique" on "status_equipamentos" ("nome");
CREATE TABLE equipamentos (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, equipamento_tipo VARCHAR(255) DEFAULT NULL COLLATE "BINARY", equipamento_fabricante VARCHAR(255) DEFAULT NULL COLLATE "BINARY", equipamento_modelo VARCHAR(255) DEFAULT NULL COLLATE "BINARY", equipamento_resolucao VARCHAR(255) DEFAULT NULL COLLATE "BINARY", equipamento_faixa_medicao VARCHAR(255) DEFAULT NULL COLLATE "BINARY", equipamento_foto VARCHAR(255) DEFAULT NULL, created_at DATETIME DEFAULT NULL, updated_at DATETIME DEFAULT NULL, classe VARCHAR(255) DEFAULT NULL COLLATE "BINARY", especificacoes CLOB DEFAULT NULL COLLATE "BINARY", patrimonio VARCHAR(255) DEFAULT NULL COLLATE "BINARY", status VARCHAR(255) DEFAULT NULL COLLATE "BINARY", setor VARCHAR(255) DEFAULT NULL COLLATE "BINARY", altura NUMERIC(10, 0) DEFAULT NULL, largura NUMERIC(10, 0) DEFAULT NULL, comprimento NUMERIC(10, 0) DEFAULT NULL, tensao VARCHAR(255) DEFAULT NULL COLLATE "BINARY", potencia VARCHAR(255) DEFAULT NULL COLLATE "BINARY", manual_pdf VARCHAR(255) DEFAULT NULL COLLATE "BINARY", link_fabricante VARCHAR(255) DEFAULT NULL COLLATE "BINARY", instrucao_uso CLOB DEFAULT NULL COLLATE "BINARY", instrucao_operacao CLOB DEFAULT NULL COLLATE "BINARY", instrucao_seguranca CLOB DEFAULT NULL COLLATE "BINARY", incerteza_nominal VARCHAR(255) DEFAULT NULL COLLATE "BINARY", categoria_metrologica VARCHAR(255) DEFAULT NULL COLLATE "BINARY", valor_aquisicao NUMERIC(10, 0) DEFAULT NULL, data_aquisicao DATE DEFAULT NULL, custo_estimado NUMERIC(10, 0) DEFAULT NULL, responsavel VARCHAR(255) DEFAULT NULL COLLATE "BINARY", frequencia_uso INTEGER DEFAULT NULL, necessidade_critica INTEGER DEFAULT NULL, abundancia INTEGER DEFAULT NULL, criticidade_metrologica INTEGER DEFAULT NULL, custo_indisponibilidade INTEGER DEFAULT NULL, igp INTEGER DEFAULT NULL, classificacao VARCHAR(255) DEFAULT NULL COLLATE "BINARY", altura_mm INTEGER DEFAULT NULL, largura_mm INTEGER DEFAULT NULL, comprimento_mm INTEGER DEFAULT NULL, tensao_v INTEGER DEFAULT NULL, potencia_w INTEGER DEFAULT NULL, data_ultima_calibracao DATE DEFAULT NULL, periodicidade_meses INTEGER DEFAULT 12 NOT NULL, localizacao VARCHAR(255) DEFAULT NULL COLLATE "BINARY", comentarios CLOB DEFAULT NULL COLLATE "BINARY", certificado_pdf VARCHAR(255) DEFAULT NULL COLLATE "BINARY", certificado_status VARCHAR(255) DEFAULT NULL COLLATE "BINARY", local_calibracao VARCHAR(255) DEFAULT NULL COLLATE "BINARY", classificacao_igp VARCHAR(255) DEFAULT NULL COLLATE "BINARY", "equipamento_classe" varchar, "equipamento_serial" varchar, "equipamento_codigo_interno" varchar, "equipamento_altura_mm" integer, "equipamento_largura_mm" integer, "equipamento_comprimento_mm" integer, "equipamento_tensao_v" integer, "equipamento_potencia_w" integer, "equipamento_incerteza_nominal" varchar, "equipamento_data_ultima_calibracao" date, "equipamento_data_proxima_calibracao" date, "equipamento_periodicidade_meses" integer, "equipamento_status" varchar not null default 'ativo', "equipamento_localizacao" varchar, "equipamento_setor" varchar, "equipamento_manual_pdf" varchar, "equipamento_link_fabricante" varchar, "equipamento_instrucao_uso" text, "equipamento_instrucao_operacao" text, "equipamento_instrucao_seguranca" text, "equipamento_comentarios" text, "equipamento_custo_estimado" numeric, "equipamento_certificado_pdf" varchar, "equipamento_certificado_status" varchar, "equipamento_local_calibracao" varchar, "equipamento_frequencia_uso" integer, "equipamento_necessidade_critica" integer, "equipamento_abundancia" integer, "equipamento_custo_indisponibilidade" integer, "equipamento_criticidade_metrologica" integer, "equipamento_igp" integer not null default '0', "equipamento_classificacao" varchar not null default 'baixa');
INSERT INTO migrations VALUES(1,'2025_11_28_000001_create_equipamentos_table',1);
INSERT INTO migrations VALUES(2,'2025_11_28_000002_create_laboratorios_table',1);
INSERT INTO migrations VALUES(3,'2025_11_28_000003_create_contratos_table',1);
INSERT INTO migrations VALUES(4,'2025_11_28_000004_create_lotes_envio_table',1);
INSERT INTO migrations VALUES(5,'2025_11_28_000005_create_lote_itens_table',1);
INSERT INTO migrations VALUES(6,'2025_11_28_000006_create_calibracoes_table',1);
INSERT INTO migrations VALUES(7,'2025_11_28_000007_create_usuarios_table',1);
INSERT INTO migrations VALUES(8,'2025_11_28_000008_create_logs_table',1);
INSERT INTO migrations VALUES(9,'2025_11_28_000009_create_parametros_metrologicos_table',1);
INSERT INTO migrations VALUES(10,'2025_11_29_165324_create_notifications_table',1);
INSERT INTO migrations VALUES(11,'2025_11_30_000001_add_csv_fields_to_equipamentos',1);
INSERT INTO migrations VALUES(12,'2025_11_30_000010_create_certificates_table',1);
INSERT INTO migrations VALUES(13,'2025_11_30_000011_create_measurement_parameters_table',1);
INSERT INTO migrations VALUES(14,'2025_11_30_000012_create_reference_standards_table',1);
INSERT INTO migrations VALUES(17,'2025_11_30_022049_add_observacoes_to_calibracoes',2);
INSERT INTO migrations VALUES(18,'2025_11_30_032500_add_missing_igp_fields',3);
INSERT INTO migrations VALUES(19,'2025_11_30_000002_update_equipamentos_table_structure',4);
